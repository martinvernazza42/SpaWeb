{% extends "base.html" %}
{% load static %}
{% block content %}

  <!-- CSS local SOLO para esta pÃ¡gina de reserva -->
  <style>
    .btn-service {
      background-color: #A3D9A5;
      border-color:     #A3D9A5;
      color:            white;
      box-shadow:       0 2px 4px rgba(0,0,0,0.1);
      transition:       transform .2s ease,
                        box-shadow .2s ease,
                        background-color .2s ease;
    }
    .btn-service:hover {
      background-color: #8CC48E;
      border-color:     #8CC48E;
      transform:        translateY(-3px);
      box-shadow:       0 6px 12px rgba(0,0,0,0.2);
      color:            white;
    }
    .btn-cart {
      margin-left: 1rem;
      padding: .25rem .5rem;
      font-size: .875rem;
    }
    .profesional-select {
      margin-top: 20px;
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #eee;
      border-radius: 5px;
      background-color: #f9f9f9;
    }
  </style>

  <div class="container mt-5" style="max-width: 500px;">
    <h2 class="mb-4">Reservar: {{ servicio.nombre }} â€” {{ day|date:"d/m/Y" }}</h2>

    {% if slots %}
      <form method="post">
        {% csrf_token %}
        <div class="list-group">
          {% for slot in slots %}
            <div class="list-group-item d-flex justify-content-between align-items-center">
              <label class="mb-0">
                <input type="radio" name="slot_id" value="{{ slot.id }}" required>
                {{ slot.hora_inicio|time:"H:i" }} â€“ {{ slot.hora_fin|time:"H:i" }}
              </label>
              {% if user.is_authenticated %}
                <a
                  href="{% url 'cart_add' servicio.id day|date:'Y-m-d' slot.hora_inicio|time:'H:i' %}"
                  class="btn btn-sm btn-cart btn-outline-secondary"
                  title="AÃ±adir este turno al carrito"
                >
                  ðŸ›’ AÃ±adir
                </a>
              {% else %}
                <a
                  href="{% url 'login' %}?next={% url 'cart_add' servicio.id day|date:'Y-m-d' slot.hora_inicio|time:'H:i' %}"
                  class="btn btn-sm btn-cart btn-outline-secondary"
                  onclick="alert('Para aÃ±adir al carrito debes iniciar sesiÃ³n');"
                  title="Inicia sesiÃ³n para aÃ±adir al carrito"
                >
                  ðŸ›’ AÃ±adir
                </a>
              {% endif %}
            </div>
          {% endfor %}
        </div>

        <!-- SelecciÃ³n de profesional -->
        <div class="profesional-select">
          <h5>Seleccionar profesional (opcional)</h5>
          <p class="text-muted small">Puedes elegir un profesional especÃ­fico o dejarlo sin seleccionar para que se asigne automÃ¡ticamente.</p>
          
          <div class="form-check">
            <input class="form-check-input" type="radio" name="profesional_id" id="sin_preferencia" value="" checked>
            <label class="form-check-label" for="sin_preferencia">
              Sin preferencia - Cualquier profesional disponible
            </label>
          </div>
          
          {% for profesional in profesionales %}
          <div class="form-check mt-2">
            <input class="form-check-input" type="radio" name="profesional_id" id="profesional_{{ profesional.id }}" value="{{ profesional.id }}">
            <label class="form-check-label" for="profesional_{{ profesional.id }}">
              {{ profesional.user.get_full_name }}
            </label>
          </div>
          {% empty %}
          <div class="text-muted">
            No hay profesionales asignados a este servicio.
          </div>
          {% endfor %}
        </div>

        <!-- BotÃ³n con nuestra clase personalizada -->
        <button type="submit"
                class="btn btn-service mt-3">
          Siguiente
        </button>
      </form>
    {% else %}
      <div class="alert alert-warning">
        No hay franjas disponibles para este dÃ­a.
      </div>
    {% endif %}

    <p class="mt-3">
      <a href="{% url 'calendario_servicio' servicio.id %}"
         class="text-secondary">&laquo; Volver al calendario
      </a>
    </p>
  </div>

{% endblock %}